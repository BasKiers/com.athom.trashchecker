<html>
<head>

<style>

</style>
</head>
<body>
	<h2 data-i18n="settings.title"></h2>
    <p style="display:block" data-i18n="settings.description"></p>
	<fieldset>
		<legend data-i18n="settings.title"></legend>
        <div class="field row">
            <label for="postcode" data-i18n="settings.postcode"></label>
            <input placeholder="1234AB" id="postcode" maxlength="6" type="text" value=""/>
        </div>
        <div class="field row">
            <label for="number" data-i18n="settings.hnumber"></label>
            <input placeholder="42" id="number" type="text" value=""/>
        </div>
        <div class="field row">
			<label style="float:left" for="country" data-i18n="settings.country"></label>
			<div style="float:left">
				<input  style="width:10px" checked="checked" id="NL" name="country" type="radio" value="NL"/><span class="name">NL</span><br>
				<input  style="width:10px" id="BE" name="country" type="radio" value="NL"/><span class="name">BE</span>
			</div>
        </div>
        <div class="field row" id="manual_input_field">
			<label style="float:left" for="manual_input_set" data-i18n="settings.manualInputField"></label>
			<div style="float:left">
				<input style="width: 10px" id="manual_input_set" name="manualInput" type="checkbox"></input><label for="manual_input_set" class="name" data-i18n="settings.manualInputFieldDescription"></label><br>
			</div>
        </div>
        <span id="resp"></span>
    </fieldset>
    <button class="left" style="display:block" onclick="save()" data-i18n="settings.save" ></button>
	<br /><br />
	<fieldset id="manual_input">
		<legend data-i18n="settings.titlemanualinput"></legend>
        
		<!-- GFT -->
		<div class="field row">
			<label style="float:left" for="gft" data-i18n="settings.gft"></label>
			<div style="float:left">
				<select name="gft[option]" id="gft_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="gft_day_div">
				<select style="margin-left: 5px;" name="gft[day_of_week]" id="gft_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="gft[option_extension]" id="gft_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="gft_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="gft[startdate]" id="gft_startdate"></input>
			</div>		
        </div>
		
		<!-- REST -->
		<div class="field row">
			<label style="float:left" for="rest" data-i18n="settings.rest"></label>
			<div style="float:left">
				<select name="rest[option]" id="rest_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="rest_day_div">
				<select style="margin-left: 5px;" name="rest[day_of_week]" id="rest_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="rest[option_extension]" id="rest_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="rest_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="rest[startdate]" id="rest_startdate"></input>
			</div>		
        </div>
		
		<!-- PAPER -->
		<div class="field row">
			<label style="float:left" for="paper" data-i18n="settings.paper"></label>
			<div style="float:left">
				<select name="paper[option]" id="paper_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="paper_day_div">
				<select style="margin-left: 5px;" name="paper[day_of_week]" id="paper_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="paper[option_extension]" id="paper_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="paper_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="paper[startdate]" id="paper_startdate"></input>
			</div>		
        </div>
		
		<!-- PLASTIC -->
		<div class="field row">
			<label style="float:left" for="plastic" data-i18n="settings.plastic"></label>
			<div style="float:left">
				<select name="plastic[option]" id="plastic_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="plastic_day_div">
				<select style="margin-left: 5px;" name="plastic[day_of_week]" id="plastic_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="plastic[option_extension]" id="plastic_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="plastic_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="plastic[startdate]" id="plastic_startdate"></input>
			</div>		
        </div>
		
		<!-- PMD -->
		<div class="field row">
			<label style="float:left" for="pmd" data-i18n="settings.pmd"></label>
			<div style="float:left">
				<select name="pmd[option]" id="pmd_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="pmd_day_div">
				<select style="margin-left: 5px;" name="pmd[day_of_week]" id="pmd_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="pmd[option_extension]" id="pmd_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="pmd_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="pmd[startdate]" id="pmd_startdate"></input>
			</div>		
        </div>
		
		<!-- TEXTILE -->
		<div class="field row">
			<label style="float:left" for="textile" data-i18n="settings.textile"></label>
			<div style="float:left">
				<select name="textile[option]" id="textile_option">
					<option value="0" data-i18n="settings.interval.na"></option>
					<option value="1" data-i18n="settings.interval.everyweek"></option>
					<option value="2" data-i18n="settings.interval.everyotherweek"></option>
					<option value="3" data-i18n="settings.interval.everythreeweeks"></option>
					<option value="4" data-i18n="settings.interval.everyfourweeks"></option>
					<option value="5" data-i18n="settings.interval.everyfirst"></option>
					<option value="6" data-i18n="settings.interval.everysecond"></option>
					<option value="7" data-i18n="settings.interval.everythird"></option>
					<option value="9" data-i18n="settings.interval.everysecondlast"></option>
					<option value="8" data-i18n="settings.interval.everylast"></option>
				</select>
			</div>
			<div style="float:left" id="textile_day_div">
				<select style="margin-left: 5px;" name="textile[day_of_week]" id="textile_dayofweek">
					<option value="1" data-i18n="settings.dayofweek.mo"></option>
					<option value="2" data-i18n="settings.dayofweek.tu"></option>
					<option value="3" data-i18n="settings.dayofweek.we"></option>
					<option value="4" data-i18n="settings.dayofweek.th"></option>
					<option value="5" data-i18n="settings.dayofweek.fr"></option>
					<option value="6" data-i18n="settings.dayofweek.sa"></option>
					<option value="0" data-i18n="settings.dayofweek.su"></option>
				</select>
			</div>
			<div style="float:left;">
				<select style="display:none; margin-left: 5px;" name="textile[option_extension]" id="textile_option_extension">
					<option value="1" data-i18n="settings.interval_extra.month"></option>
					<option value="3" data-i18n="settings.interval_extra.quarter"></option>
					<option value="12" data-i18n="settings.interval_extra.year"></option>
				</select>
			</div>
			<div style="float: left;" id="textile_startdate_div">
				<p style="display: inline; margin-left: 5px;" for="startdate" data-i18n="settings.startdate"></p>
				<input style="display: inline; margin-left: 5px;" type="date" name="textile[startdate]" id="textile_startdate"></input>
			</div>		
        </div>
    </fieldset>
	<button id="manualInput" class="left" style="display:block" onclick="saveManualInput()" data-i18n="settings.saveManualInput" ></button>
	<br /><br />

	<script type="text/javascript">

        function onHomeyReady()
		{
			// Register on change events of fields in settings page.
			document.getElementById("manual_input_set").addEventListener("change", OnManualInputCheckboxChanged);
			document.getElementById("gft_option").addEventListener("change", function(elem) { ToggleManualInputFields("gft"); });
			document.getElementById("paper_option").addEventListener("change",function(elem) { ToggleManualInputFields("paper"); });
			document.getElementById("rest_option").addEventListener("change", function(elem) { ToggleManualInputFields("rest"); });
			document.getElementById("plastic_option").addEventListener("change", function(elem) { ToggleManualInputFields("plastic"); });
			document.getElementById("pmd_option").addEventListener("change", function(elem) { ToggleManualInputFields("pmd"); });
			document.getElementById("textile_option").addEventListener("change", function(elem) { ToggleManualInputFields("textile"); });
			
			// Set properties
			OnManualInputCheckboxChanged();
			ToggleManualInputFields("gft");
			ToggleManualInputFields("paper");
			ToggleManualInputFields("rest");
			ToggleManualInputFields("plastic");
			ToggleManualInputFields("pmd");
			ToggleManualInputFields("textile");
			
			// Retrieve values from Homey settings			
        	Homey.get('postcode', function(err, postcode){
        		if(err)
        		{
        			console.log("not working");
        			return console.error(err);
        		}
        		document.getElementById('postcode').value = postcode;
        	});

        	Homey.get('hnumber', function(err, housenumber){
        		if(err) return console.error(err);
        		document.getElementById('number').value = housenumber;
        	});

        	Homey.get('country',function(err, country){
        		console.log(country);
        		if(err){
        			return console.error(err);
        		}
				
        		if(country == 'NL' || country == 'BE'){
        			document.getElementById(country).checked = true;
        		}else{
        			document.getElementById('NL').checked = true;
        		}
        	});
			
        	Homey.get('manualInput',function(err, manualInput) {
				console.log(manualInput);
        		if(err) {
        			return console.error(err);
        		}
			
				if(manualInput !== true)
				{
					console.log("manual input deactivated");
					return;
				}
				
				document.getElementById('manual_input_set').checked = true;
				OnManualInputCheckboxChanged();
			
        		Homey.get('manualEntryData',function(err, manualEntryData) {
					console.log(manualEntryData);
					if(err) {
						return console.error(err);
					}
					
					if(typeof manualEntryData.gft !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.gft, "gft");
					}
					
					if(typeof manualEntryData.paper !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.paper, "paper");
					}
					
					if(typeof manualEntryData.rest !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.rest, "rest");
					}
					
					if(typeof manualEntryData.plastic !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.plastic, "plastic");
					}
					
					if(typeof manualEntryData.pmd !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.pmd, "pmd");
					}
					
					if(typeof manualEntryData.textile !== 'undefined')
					{
						SetManualEntryFormValues(manualEntryData.textile, "textile");
					}
				});
			});

            Homey.ready()
        }

		// Save zipcode and housenumber to Homey Settings
        function save() {
			var resp = document.getElementById("resp");
				resp.style.color = 'black';
				resp.innerHTML = __('settings.checking');
        	var pc = document.getElementById('postcode').value;
        	var num = document.getElementById('number').value;

        	var country;
        	if(document.getElementById('NL').checked) {
            	country = 'NL';
            }else if(document.getElementById('BE').checked) {
            	country = 'BE';
            }
			
			var manualInput = false;
			if(document.getElementById('manual_input_set').checked) {
            	manualInput = true;
            }

        	Homey.api('POST', '/', {

        		"postcode":pc,
        		"housenumber":num,
        		"country":country

        	}, function(err,result) {
        		if(err) return console.log(err);

        		if(result) {
					resp.style.color = 'green';
					//resp.data-i18n = 'settings.update'
					resp.innerHTML = __('settings.update') + pc + ', ' + num + ' in ' + country;
		            Homey.set('postcode',pc);
		            Homey.set('hnumber',num);
		            Homey.set('country',country);
	        	}
				else
				{
					resp.innerHTML = __('settings.fail');
					resp.style.color = 'red';
	        	}
				
				Homey.set('manualInput', manualInput);
				
        		//Do stuff if true/false (kruis,vinkje)
        		console.log(result);
        	});
        }

		// Save manual input data to Homey Settings
		function saveManualInput()
		{
			Homey.set('manualInput', true);
			
			var data = {};
			data = SetManualInputDataFor("gft", data);
			data = SetManualInputDataFor("rest", data);
			data = SetManualInputDataFor("pmd", data);
			data = SetManualInputDataFor("plastic", data);
			data = SetManualInputDataFor("paper", data);
			data = SetManualInputDataFor("textile", data);
			
			console.log(data);
			Homey.set('manualEntryData', data);
		}
		
		// Sets values given in "values" to the given "type" on the form.
		function SetManualEntryFormValues(values, type)
		{
			document.getElementById(type + "_option").value = values.option;
			document.getElementById(type + "_dayofweek").value = values.day;
			document.getElementById(type + "_option_extension").value = values.option_extension;
			
			if(typeof values.startdate !== 'undefined' && values.startdate !== null)
			{
				document.getElementById(type + "_startdate").value = values.startdate.substring(0, 10);
			}
			
			ToggleManualInputFields(type);
		}
		
		// Retrieves all manual values from the form based on given "type" and adds them to the "data" element.
		function SetManualInputDataFor(type, data)
		{
			// If not applicable, leave empty.
			if(document.getElementById(type + "_option").value == 0)
			{
				return data;
			}
			
			data[type] = {};
			data[type].option = document.getElementById(type + "_option").value;
			data[type].startdate = document.getElementById(type + "_startdate").value;
			data[type].day = document.getElementById(type + "_dayofweek").value;
			
			if(data[type].option >= 4) {
				data[type].option_extension = document.getElementById(type + "_option_extension").value;
			}
			else {
				data[type].option_extension = -1;
			}		
		
			return data;
		}
		
		// Toggles manual input fieldset based on "Manual Input" checkbox
		function OnManualInputCheckboxChanged()
		{	
			if(document.getElementById('manual_input_set').checked)
			{
				document.getElementById("manual_input").style.display = 'block';
				document.getElementById("manualInput").style.display = 'block';
			}
			else
			{
				document.getElementById("manual_input").style.display = 'none';
				document.getElementById("manualInput").style.display = 'none';
			}
		}
		
		// Toggles fields on the form based on the given element
		function ToggleManualInputFields(prefix)
		{
			var value = document.getElementById(prefix + "_option").value;
		
			if(value >= 5) {
				document.getElementById(prefix + "_option_extension").style.display = 'block';
				document.getElementById(prefix + "_startdate_div").style.display = 'none';
				document.getElementById(prefix + "_day_div").style.display = 'block';
			}
			else if(value == 1)
			{
				document.getElementById(prefix + "_option_extension").style.display = 'none';
				document.getElementById(prefix + "_startdate_div").style.display = 'none';
				document.getElementById(prefix + "_day_div").style.display = 'block';
			}
			else if(value == 0)
			{
				document.getElementById(prefix + "_option_extension").style.display = 'none';
				document.getElementById(prefix + "_startdate_div").style.display = 'none';
				document.getElementById(prefix + "_day_div").style.display = 'none';
			}
			else {
				document.getElementById(prefix + "_option_extension").style.display = 'none';
				document.getElementById(prefix + "_startdate_div").style.display = 'block';
				document.getElementById(prefix + "_day_div").style.display = 'block';
			}
		}
		
		
		
		
		
function CalculatePickupDates(settings)
{
	var result = [];

	var interval = -1;
	try { 
		interval = parseInt(settings.option);
	} catch(e) { console.log(e); };
	
	var intervalExtended = -1;
	try { 
		intervalExtended = parseInt(settings.option_extension);
	} catch(e) { console.log(e); };
	
	var startDate = new Date(Date.now());
	try { 
		startDate = settings.startdate;
	} catch(e) { console.log(e); };
	
	var dayOfWeek = null;
	try { 
		dayOfWeek = parseInt(settings.day);
	} catch(e) { console.log(e); };
	
	var currentDate = new Date(Date.now());
	var startDate = new Date(startDate);
	
	var firstDayInCurrentMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
	var previousMonth = new Date(new Date(firstDayInCurrentMonth).setMonth(firstDayInCurrentMonth.getMonth()-1));
	var nextMonth = new Date(new Date(firstDayInCurrentMonth).setMonth(firstDayInCurrentMonth.getMonth()+1));
	var afterNextMonth = new Date(new Date(firstDayInCurrentMonth).setMonth(firstDayInCurrentMonth.getMonth()+2));
	
	if(interval >= 5 && interval <= 7) // every x-th week of month/quarter/year
	{
		var nThWeek = interval-4;
		var date1 = new Date();
		var date2 = new Date();
		var date3 = new Date();
		
		if(intervalExtended == 12) // every x-th week of the year
		{
			date1 = nthDayInMonth(nThWeek, dayOfWeek, 0, currentDate.getFullYear()-1);
			date2 = nthDayInMonth(nThWeek, dayOfWeek, 0, currentDate.getFullYear());
			date3 = nthDayInMonth(nThWeek, dayOfWeek, 0, currentDate.getFullYear()+1);
		}
		else if(intervalExtended == 3) // every x-th week of the quarter
		{
			var currentQuarter = ((currentDate.getMonth()-((currentDate.getMonth()+3)%3))/3);
			var currentQuarterStart = new Date(currentDate.getFullYear(), currentQuarter*3, 1);
			var previousQuarterStart = new Date(new Date(currentQuarterStart).setMonth(currentQuarterStart.getMonth()-3));
			var nextQuarterStart = new Date(new Date(currentQuarterStart).setMonth(currentQuarterStart.getMonth()+3));
			
			date1 = nthDayInMonth(nThWeek, dayOfWeek, previousQuarterStart.getMonth(), previousQuarterStart.getFullYear());
			date2 = nthDayInMonth(nThWeek, dayOfWeek, currentQuarterStart.getMonth(), currentQuarterStart.getFullYear());
			date3 = nthDayInMonth(nThWeek, dayOfWeek, nextQuarterStart.getMonth(), nextQuarterStart.getFullYear());
		}
		else // every x-th week of the month
		{		
			date1 = nthDayInMonth(nThWeek, dayOfWeek, previousMonth.getMonth(), previousMonth.getFullYear());
			date2 = nthDayInMonth(nThWeek, dayOfWeek, firstDayInCurrentMonth.getMonth(), firstDayInCurrentMonth.getFullYear());
			date3 = nthDayInMonth(nThWeek, dayOfWeek, nextMonth.getMonth(), nextMonth.getFullYear());
		}
		
		result.push(dateToString(date1));
		result.push(dateToString(date2));
		result.push(dateToString(date3));
	}
	else if(interval <= 4) // per week
	{
		var date0 = everyNthWeek(interval, dayOfWeek, startDate, currentDate, -2);
		var date1 = everyNthWeek(interval, dayOfWeek, startDate, currentDate, -1);
		var date2 = everyNthWeek(interval, dayOfWeek, startDate, currentDate, 0);
		var date3 = everyNthWeek(interval, dayOfWeek, startDate, currentDate, 1);
		var date4 = everyNthWeek(interval, dayOfWeek, startDate, currentDate, 2);
		
		result.push(dateToString(date0));
		result.push(dateToString(date1));
		result.push(dateToString(date2));
		result.push(dateToString(date3));
		result.push(dateToString(date4));
	}
	else if(interval >= 8 && interval <= 9) // every last, every second last
	{
		var nthLastWeekOf = interval-7;
		
		var date1 = new Date();
		var date2 = new Date();
		var date3 = new Date();
		var date4 = new Date();
		
		if(intervalExtended == 12) // every x-th last week of the year
		{
			date1 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, 0, currentDate.getFullYear()-1);
			date2 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, 0, currentDate.getFullYear());
			date3 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, 0, currentDate.getFullYear()+1);
			date4 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, 0, currentDate.getFullYear()+2);
		}
		else if(intervalExtended == 3) // every x-th last week of the quarter
		{
			var currentQuarter = ((currentDate.getMonth()-((currentDate.getMonth()+3)%3))/3);
			var currentQuarterStart = new Date(currentDate.getFullYear(), currentQuarter*3, 1);
			var previousQuarterStart = new Date(new Date(currentQuarterStart).setMonth(currentQuarterStart.getMonth()-3));
			var nextQuarterStart = new Date(new Date(currentQuarterStart).setMonth(currentQuarterStart.getMonth()+3));
			var overNextQuarterStart = new Date(new Date(currentQuarterStart).setMonth(currentQuarterStart.getMonth()+6));
			
			date1 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, previousQuarterStart.getMonth(), previousQuarterStart.getFullYear());
			date2 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, currentQuarterStart.getMonth(), currentQuarterStart.getFullYear());
			date3 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, nextQuarterStart.getMonth(), nextQuarterStart.getFullYear());
			date4 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, overNextQuarterStart.getMonth(), overNextQuarterStart.getFullYear());
		}
		else // every x-th last week of the month
		{		
			date1 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, previousMonth.getMonth(), previousMonth.getFullYear());
			date2 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, firstDayInCurrentMonth.getMonth(), firstDayInCurrentMonth.getFullYear());
			date3 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, nextMonth.getMonth(), nextMonth.getFullYear());
			date4 = nthLastDayInMonth(nthLastWeekOf, dayOfWeek, afterNextMonth.getMonth(), afterNextMonth.getFullYear());
		}
		
		result.push(dateToString(date1));
		result.push(dateToString(date2));
		result.push(dateToString(date3));
		result.push(dateToString(date4));
	}
	
	return result;
}

function dateToString(inputDate)
{
	//console.log(inputDate);

	var dateString = pad( inputDate.getDate(), 2);
	dateString += '-';
	dateString += pad( inputDate.getMonth()+1, 2);
	dateString += '-';
	dateString += inputDate.getFullYear();
		
	return dateString;
}

function toDays(d) {
	d = d || 0;
	return d / 24 / 60 / 60 / 1000;
}

function daysInMonth(m, y) { 
	var y = y || new Date(Date.now()).getFullYear(); 
	return toDays(Date.UTC(y, m + 1, 1) - Date.UTC(y, m, 1)); 
}

function toUTC(d) { 
	if(!d || !d.getFullYear) return 0; 
	return Date.UTC(d.getFullYear(), d.getMonth(),d.getDate());
}

function daysBetween(d1,d2) { 
	return toDays(toUTC(d2)-toUTC(d1)); 
}

function firstDayInMonth(day, m, y) {
	return new Date(y, m, 1 + (day - new Date(y, m, 1).getDay() + 7) % 7);
}

function nthLastDayInMonth(n, day, m, y)
{
	var d = firstDayInMonth(day, m, y);
	return new Date(d.getFullYear(), d.getMonth(), (d.getDate() - (n * 7)));
}

function nthDayInMonth(n, day, m, y) { 	
	var d = firstDayInMonth(day, m, y);
	return new Date(d.getFullYear(), d.getMonth(), d.getDate() + (n - 1) * 7);
}

function everyNthWeek(n, d, givenDate, currentDate, delta)
{
	var correctWithDays = d - currentDate.getDay();
	givenDate = new Date(givenDate.getFullYear(), givenDate.getMonth(), (givenDate.getDate() + (d - givenDate.getDay())));
	currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), (currentDate.getDate() + (d - currentDate.getDay())));
	
	var difference = daysBetween(givenDate, currentDate);
	if(difference < 0) { difference = difference * -1; }
	
	var differenceWithCurrentDate = (difference % (n * 7)) + (delta * n * 7);
	
	return new Date(currentDate.getFullYear(), currentDate.getMonth(), (currentDate.getDate() + differenceWithCurrentDate));
}

function pad(input, amount)
{
	if(input.length == 1)
	{
		return "0" + input;
	}
	return input;
}
		
		
console.log(CalculatePickupDates({ option: "1", "option_extension": "1", startdate: null, day: "1" }));
console.log(CalculatePickupDates({ option: "2", "option_extension": "1", startdate: "01-01-2016", day: "2" }));
console.log(CalculatePickupDates({ option: "3", "option_extension": "1", startdate: "01-01-2016", day: "3" }));
console.log(CalculatePickupDates({ option: "4", "option_extension": "1", startdate: "01-01-2016", day: "4" }));

console.log("elke eerste maandag van de maand");
console.log(CalculatePickupDates({ option: "5", "option_extension": "1", startdate: "01-01-2016", day: "1" }));

console.log("elke tweede dinsdag van het kwartaal");
console.log(CalculatePickupDates({ option: "6", "option_extension": "3", startdate: "01-01-2016", day: "2" }));

console.log("elke derde woensdag van het jaar");
console.log(CalculatePickupDates({ option: "7", "option_extension": "12", startdate: "01-01-2016", day: "3" }));

console.log("elke laatste donderdag van de maand");
console.log(CalculatePickupDates({ option: "8", "option_extension": "1", startdate: "01-01-2016", day: "4" }));	

console.log("elke een na laatste vrijdag van het kwartaal");
console.log(CalculatePickupDates({ option: "9", "option_extension": "3", startdate: "01-01-2016", day: "5" }));	

console.log("elke een na laatste zaterdag van het jaar");
console.log(CalculatePickupDates({ option: "9", "option_extension": "12", startdate: "01-01-2016", day: "6" }));	

	</script>
<body>
</html>
